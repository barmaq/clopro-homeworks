
создаем вм




-------------------
application load balancer
создаем балансировщик
добавляем проверки состояний


создаем https \ https роутер

создание балансировщика

-------------------

создаем группу вирт машин



создание сетевого балансировщика


------------------------------------

Создать бакет Object Storage и разместить в нём файл с картинкой:
Создать бакет в Object Storage с произвольным именем (например, имя_студента_дата).
Положить в бакет файл с картинкой.
Сделать файл доступным из интернета.

https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/iam_service_account_static_access_key
https://terraform-provider.yandexcloud.net/Resources/iam_service_account_static_access_key
https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/iam_service_account_static_access_key




Создать группу ВМ в public подсети фиксированного размера с шаблоном LAMP и веб-страницей, содержащей ссылку на картинку из бакета:
Создать Instance Group с тремя ВМ и шаблоном LAMP. Для LAMP рекомендуется использовать image_id = fd827b91d99psvq5fjit.
Для создания стартовой веб-страницы рекомендуется использовать раздел user_data в meta_data.
Разместить в стартовой веб-странице шаблонной ВМ ссылку на картинку из бакета.

как вариант через 

    metadata = {
      user-data = "${file("cloud_conf.yaml")}"
    }


Настроить проверку состояния ВМ.
Подключить группу к сетевому балансировщику:
Создать сетевой балансировщик.
Проверить работоспособность, удалив одну или несколько ВМ.


при terraform destroy не удаляется группа вирт машин ( защиты от удаления не стоит ). висит статус на вирт машинах :
CLOSING_TRAFFIC [20m] | [PERMISSION_DENIED] Permission denied to operate with resource                 
и группа вирт машин в вечном статусе "удаление"
network-load-balancer к этому времени уже удален

из консоли и интерфейса облака то же самое - статус deleting  с этим же сообщением. прав 



